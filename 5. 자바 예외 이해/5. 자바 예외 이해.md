## 자바 예외 이해

### 예외 계층

- 이미지는 강의 자료 참고

- `Object` : 예외도 객체임. 모든 객체의 최상위 부모는 Object이므로 예외의 최상위 부모도 Object임.

- `Throwable` : 최상위 예외임. 하위에 `Exception`과 `Error`가 있음.

- `Error` : 메모리 부족이나 심각한 시스템 오류와 같이 애플리케이션에서 복구 불가능한 시스템 예외임. 애플리케이션 개발자는 이 예외를 잡으려고 해서는 안됨. (언체크 예외임.)

- `Exception` : 체크 예외로 애플리케이션 로직에서 사용할 수 있는 실질적인 최상위 예외임. `Exception`과 그 하위 예외는 모두 컴파일러가 체크하는 체크 예외임. 단, `RuntimeException`은 예외로 함.

- `RuntimeException` : 언체크 예외, 런타임 예외로 컴파일러가 체크하지 않는 언체크 예외임. `RuntimeException`과 그 자식 예외는 모두 언체크 예외임.

---

### 예외 기본 규칙

- 예외는 폭탄 돌리기와 같음. 잡아서 처리하거나, 처리할 수 없으면 밖으로 던져야 함.

- 예외 2가지 기본 규칙

1. 예외는 잡아서 처리하거나 던져야 함.

2. 예외를 잡거나 던질 때 지정한 예외뿐만 아니라 그 예외의 자식들도 함께 처리됨.<br/>
   -> 예를 들어서 `Exception`을 `catch`로 잡으면 그 하위 예외들도 모두 잡을 수 있음.<br/>
   -> 예를 들어서 `Exception`을 `throws`로 던지면 그 하위 예외들도 모두 던질 수 있음.

- cf) 예외를 처리하지 못하고 계속 던지면 어떻게 될까?<br/>
  -> 자바 main() 쓰레드의 경우 예외 로그를 출력하면서 시스템이 종료됨.<br/>
  -> 웹 애플리케이션의 경우 여러 사용자의 요청을 처리하기 때문에 하나의 예외 때문에 시스템이 종료되면 단됨. WAS가 해당 예외를 받아서 처리하는데, 주로 사용자에게 개발자가 지정한 오류 페이지를 보여줌.

---

### 체크 예외 기본 이해

- `Exception`과 그 하위 예외는 모두 컴파일러가 체크하는 체크 예외임.

- 단, `RuntimeException`은 예외로 함.

- 체크 예외는 잡아서 처리하거나, 또는 밖으로 던지도록 선언해야 함. 그렇지 않으면 컴파일 오류가 발생함.

- 관련 코드는 github 소스 코드 참고

- 체크 예외 장단점

1. 장점: 개발자가 실수로 예외를 누락하지 않도록 해줌
2. 단점: 실제로는 개발자가 모든 체크 예외를 잡거나 던지도록 처리해야해서 번거로울 수 있으며, 의존관계에 따른 단점도 있음.

---

### 언체크 예외 기본 이해

- `RuntimeException`과 그 하위 예외는 언체크 예외로 분류됨.

- 언체크 예외는 컴파일러가 예외를 체크하지 않으며, 체크 예외와 기본적으로 동일함.

- 언체크 예외는 `throws`를 선언하지 않고, 생략할 수 있음. 이 경우 자동으로 예외를 던짐.

- 관련 코드는 github 소스 코드 참고

- 언체크 예외 장단점

1. 장점: 신경쓰고 싶지 않은 언체크 예외를 무시할 수 있음.
2. 단점: 개발자가 실수로 예외를 누락할 수 있음.

---

### 체크 예외 활용 & 언체크 예외 활용

- 언제 체크 예외를 사용하고 언제 언체크(런타임) 예외를 사용하면 좋을까?

- 기본 원칙 2가지

1. 기본적으로 언체크(런타임) 예외를 사용하자.
2. 체크 예외는 비즈니스 로직상 의도적으로 던지는 예외에만 사용하자.<br/>
   ex) 계좌 이체 실패 예외, 결제시 포인트 부족 예외, 로그인 ID/PW 불일치 예외 등

- 관련 코드는 github 소스 코드 참고

- 처리할 수 있는 체크 예외라면 서비스나 컨트롤러에서 처리하겠지만, 데이터베이스나 네트워크 통신처럼 시스템 레벨에서 올라온 예외들은 대부분 복구가 불가능함.<br/>

- cf) 실무에서 발생하는 대부분의 예외들은 이런 시스템 예외들임.

- 문제는 이런 경우에 체크 예외를 사용하면 아래에서 올라온 복구 불가능한 예외를 서비스, 컨트롤러 같은 각각의 클래스가 모두 알고 있어야 함. 그래서 불필요한 의존관계 문제가 발생하게 됨.

- `throws Exception`<br/>
  : `Exception`은 최상위 타입이므로 모든 체크 예외를 다 밖으로 던지는 문제가 발생함.<br/>
  : 결과적으로 이걸 사용하게 되면 다른 체크 예외를 체크할 수 있는 기능이 무효화되고, 중요한 체크 예외를 다 놓치게 됨.<br/>
  : 꼭 필요한 경우가 아니면 `Exception` 자체를 밖으로 던지는 것은 좋지 않은 방법임.

- 체크 예외의 문제점 때문에 최근 라이브러리들은 대부분 런타임 예외를 기본으로 제공함.

- 스프링도 대부분 런타임 예외를 제공함.

- 런타임 예외도 필요하면 잡을 수 있기 때문에 필요한 경우에는 잡아서 처리하고, 그렇지 않으면 자연스럽게 던지도록함. 그리고 예외를 공통으로 처리하는 부분을 앞에 만들어서 처리하면 됨.

- 추가적으로 런타임 예외는 놓칠 수 있기 때문에 문서화가 중요함.

---

### 예외 포함과 스택 트레이스

- 예외를 전환할 때는 꼭 기존 예외를 포함해야 함. 그렇지 않으면 스택 트레이스를 확인할 때 심각한 문제가 발생함.

- `System.out`에 스택 트레이스를 출력하려면 `e.printStackTrace()`를 사용하면 되지만 실무에서는 항상 로그를 사용해야 한다는 점 기억!

---

### 정리 및 회고

- 이번 학습을 통해서 자바 예외에 대해 정확히 알게 되었다.

- 또한, `RuntimeException`에 대해서는 알고 있었지만 이게 언체크 예외를 뜻하는지는 몰랐었다. 이번에 체크 예외와 언체크 예외에 대해 공부하면서 개념을 다시 잡는 계기가 되었다.
